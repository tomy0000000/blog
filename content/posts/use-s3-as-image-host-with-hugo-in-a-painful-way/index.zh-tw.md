---
title: "å¦‚ä½• (éå¸¸æŠ˜é¨°çš„) åœ¨ Hugo ä½¿ç”¨å¤–éƒ¨åœ–åºŠ"
date: 2025-08-24T20:29:53-07:00
description: "éƒ¨è½æ ¼çš„ç¬¬ä¸€å€‹å¤§æ›´æ–°"
categories: ["ğŸ¤– é–‹ç™¼"]
series: ["âœğŸ» éƒ¨è½æ ¼"]
---

è¶è‘— 7 æœˆå ±å ±ä¸Šä¹‹å‰æŠŠéƒ¨è½æ ¼åšäº†ä¸€å€‹å…§éƒ¨çš„å¤§æ”¹ç‰ˆï¼Œé›–ç„¶æ˜¯å…§éƒ¨çš„æ›´æ–°ï¼Œè®€è€…æ‡‰è©²ä¸æœƒæ„Ÿå—åˆ°ï¼Œä½†é‚„æ˜¯ä¸€æ¬¡æœ‰é»äº›å¾®è¤‡é›œçš„é‡æ§‹ï¼Œè¦ºå¾—æŒºæœ‰æ„æ€çš„ï¼Œæƒ³èªªå¯ä»¥é›£å¾—å¯«é»æŠ€è¡“çš„æ±è¥¿ï¼Œè¨˜éŒ„ä¹‹é¤˜ä¹Ÿé †ä¾¿åˆ†äº«ä¸€ä¸‹ã€‚

## ç‹€æ³

é€™å€‹éƒ¨è½æ ¼çš„åŸå§‹ç¢¼å’Œå…§å®¹å…¨éƒ¨éƒ½æœ‰å…¬é–‹åœ¨æˆ‘çš„ [GitHub](https://github.com/tomy0000000/blog) ä¸Šï¼Œä½†é‚„æ˜¯ç°¡å–®å¿«é€Ÿçš„å¸¶éä¸€ä¸‹ï¼š

- å…§å®¹å…¨éƒ¨éƒ½æ˜¯ Markdown ç·¨å¯«çš„
- ä½¿ç”¨ Hugo åœ¨ GitHub Action ä¸Šä¾†éœæ…‹ç”Ÿæˆç¶²ç«™
- éƒ¨ç½²åœ¨ GitHub Pages ä¸Š

Hugo ä½œç‚ºä¸€å€‹æ¡†æ¶ï¼Œä¸å–®å–®åªæ˜¯åš Markdown è½‰æˆ HTMLï¼Œå°æ–¼æ–‡ç« å…§ä½¿ç”¨çš„è³‡æºï¼Œæ¯”æ–¹èª¬åœ–ç‰‡ï¼Œä¹Ÿæœ‰å¾ˆå¤š[å…§å»º](https://gohugo.io/functions/images/)çš„å„ªåŒ–é¸é …ï¼Œæ¯”æ–¹èª¬æ”¾å¤§ç¸®å°ï¼Œæˆ–æ˜¯æœ€ä½³åŒ–è™•ç†ï¼Œä½†é€™ä¹Ÿé€ æˆä¸€äº›å¾ŒçºŒçš„å•é¡Œã€‚

åœ¨éƒ¨è½æ ¼å‰›é–‹å¼µçš„æ™‚å€™å°±çŸ¥é“ï¼ŒæŠŠæ–‡ç« ä½¿ç”¨åˆ°çš„åœ–ç‰‡ check in é€² git ä¸æ˜¯ä¸€å€‹å¥½ä¸»æ„ï¼Œé•·æœŸä¸‹ä¾†æœƒæœ‰å¾ˆå¤šå•é¡Œï¼Œä½†ç•¶æ™‚æ±ºå®šç§‰æŒè‘— Move fast, Break thing çš„æ€ç¶­ï¼Œæˆ‘åªæƒ³å„˜å¿«çš„è®“ç¶²ç«™ä¸Šç·šï¼Œæ–¼æ˜¯æ±ºå®šå…ˆç¡¬è‘—é ­çš®é€™éº¼åšï¼ŒæŠŠé€™å€‹å•é¡Œç•™åˆ°ä¹‹å¾Œå†è§£æ±º [^1]ï¼Œè€Œå¯«äº†å…©å¹´éƒ¨è½æ ¼ä¹‹å¾Œï¼Œé€™å€‹å•é¡Œä¹Ÿåƒæ»¾é›ªçƒä¸€æ¨£ï¼Œæ¼¸æ¼¸è®Šçš„å¤§åˆ°é›£ä»¥å¿½è¦–ã€‚

æ‰€ä»¥åœ¨ git è£¡ check in åœ–ç‰‡ (æˆ–è€…æ›´å»£æ³›çš„ä¾†èªªï¼šä»»ä½•å¤§æª”æ¡ˆ) åˆ°åº•æœ‰ä»€éº¼å•é¡Œï¼Ÿ

- git çš„å£“ç¸®æ¼”ç®—æ³•åå¥½å„ªåŒ–ç´”æ–‡å­—ï¼Œbinary æ ¼å¼çš„æª”æ¡ˆå£“ç¸®æ•ˆæœä¸å¥½
- ä¹Ÿå°±æ˜¯èªª `git clone`, æˆ–æ˜¯ `git pull` é€Ÿåº¦æœƒæ¼¸æ¼¸è¢«æ‹–æ…¢
- åªè¦æ›¾ç¶“ check in éï¼Œä¹‹å¾Œå°±ç®—å†ç§»é™¤ï¼Œé€™äº›æ›¾ç¶“å­˜åœ¨çš„æª”æ¡ˆä»ç„¶æœƒä½”æ“šä½¿ç”¨ç©ºé–“

è€Œåœ¨ Hugo é€™é‚Šï¼Œå› ç‚ºæˆ‘ä½¿ç”¨çš„ä¸»é¡Œ Congo æœƒè‡ªå‹•åœ¨ç¶²ç«™ç”Ÿæˆçš„æ™‚å€™ï¼Œäº‹å…ˆæŠŠä¸€ä»½åœ–ç‰‡è½‰æˆä¸åŒå¤§å°ï¼Œä¾†åŠ é€Ÿç¶²ç«™åœ¨ä¸åŒå°ºå¯¸çš„è¢å¹•ä¸‹çš„è¼‰å…¥æ™‚é–“ï¼Œæ‰€ä»¥åœ–ç‰‡ä¸€ä½†è®Šå¤šï¼Œä¹Ÿå°±ä»£è¡¨ Hugo åœ¨ç”Ÿæˆç¶²ç«™çš„æ™‚é–“æœƒéš¨è‘—åœ–ç‰‡æ•¸é‡è·Ÿè‘—å¢åŠ ã€‚

[^1]: åæ­£å¦‚æœéƒ¨è½æ ¼åŠè·¯å‡ºå®¶äº†ï¼Œé€™å•é¡Œä¹Ÿå°±ä¸ç”¨è™•ç†äº† (?)

## è§£æ±ºæ–¹æ³•

è§£æ–¹ä¹Ÿå¾ˆç°¡å–®ï¼šæ‰€æœ‰çš„åœ–ç‰‡ä¸€å¾‹é·ç§»åˆ°å¤–éƒ¨ç¨ç«‹çš„åœ–åºŠè¨—ç®¡ï¼Œç„¶å¾Œéƒ¨è½æ ¼ç›´æ¥æŠŠæ‰€æœ‰çš„åœ–ç‰‡æŒ‡å‘é‚£å€‹åœ–åºŠã€‚

æˆ‘ç°¡å–®ç ”ç©¶äº†ä¸€ä¸‹å¸‚é¢ä¸Šçš„åœ–ç‰‡ä»£ç®¡æœå‹™ï¼Œæ•´ç†äº†[ä¸€ä»½ç­†è¨˜](https://docs.tomy.me/image-hosting)ï¼Œæƒ³åˆ°äº†æœ€ç°¡å–®çš„åšæ³•æ˜¯ï¼šé–‹ä¸€å€‹ S3 çš„ bucketï¼Œç„¶å¾ŒæŠŠæ•´å€‹ç›®éŒ„çµæ§‹è¤‡è£½éå»ã€‚

æ¯”æ–¹èª¬åŸæœ¬æœ‰ä¸€å¼µåœ–ç‰‡åœ¨

```
https://blog.tomy.me/zh-tw/posts/
2025-may-dump/cmu-commencement-with-taiwanese.jpg
```

åœ¨é·ç§»ä¹‹å¾Œå°±æœƒè®Šæˆ

```
https://img.tomy.me/blog/
2025-may-dump/cmu-commencement-with-taiwanese.jpg
```

é€™æ¨£æœ‰å¹¾å€‹å¥½è™•ï¼š

- è·Ÿå…¶ä»–ç›¸å°è¤‡é›œçš„æ–¹æ¡ˆæ¯”èµ·ä¾†æ²’æœ‰å¾ˆè¤‡é›œï¼Œæœªä¾†å¦‚æœè¦å†äºŒåº¦é·ç§»æ¯”è¼ƒä¸æœƒé‡åˆ°å¤ªå¤§çš„å•é¡Œã€‚
- æµé‡å°çš„æ™‚å€™ä¸ç”¨éŒ¢ï¼Œå°±ç®—æœªä¾†çœŸçš„æµé‡æš´æ¼²æ‡‰è©²ä¹Ÿä¸æœƒç‡’å¤šå°‘éŒ¢ (åæ­£æˆ‘çš„éƒ¨è½æ ¼æ²’ä»€éº¼äººåœ¨çœ‹ å˜»å˜»)

ç¼ºé»çš„è©±ï¼š

- æ¯æ¬¡å¯«å®Œæ–‡ç« ï¼Œè¦å†å¦å¤–æ‰‹å‹•ä¸Šå‚³é€™äº›ç…§ç‰‡ã€‚ä½†å…¶å¯¦å¦‚æœæœ‰ S3 Client çš„è©±ï¼Œä¹Ÿä¸æ˜¯å¤šéº»ç…©çš„äº‹
- å¤±å» Hugo å…§å»ºçš„åœ–ç‰‡æœ€ä½³åŒ–è™•ç†ï¼Œè¼‰å…¥é€Ÿåº¦æœƒæ…¢ä¸€é»é»ã€‚ä½†ä¹ŸçœŸçš„å°±æ˜¯ä¸€é»é»ï¼Œè€Œä¸”æœªä¾†æœ‰æ©Ÿæœƒå†å¼„å›ä¾†

å¯¦å‹™ä¸Šä¾†èªªï¼Œæˆ‘æœ€å¾Œ S3 æ²’æœ‰åœ¨ AWS é–‹ã€‚å¤ªè¤‡é›œäº†ï¼ŒèŠ±äº†å¤§æŠŠæ™‚é–“åªæå®šäº†å¤§æ¦‚ 90%ï¼Œå‰©ä¸‹ 10% çš„å•é¡Œé›£ä»¥è§£æ±ºï¼Œç‚ºäº†é¿å…æœªä¾†é‡åˆ° [only god knows](https://img.tomy.me/blog/use-s3-as-image-host-with-hugo-in-a-painful-way/only-god-knows.webp) çš„å ´æ™¯ç™¼ç”Ÿï¼Œæˆ‘æ±ºå®šæ›åˆ°ä¸€å€‹ç›¸å°ç°¡å–®çš„ S3 â€”â€” Cloudflare R2ã€‚

åŒæ™‚æ‰€æœ‰çš„åœ–ç‰‡éƒ½æ˜¯åœ¨ `/blog` ä¹‹ä¸‹ï¼Œæ‰€ä»¥å¦‚æœæœªä¾†æœ‰åˆ¥çš„å°ˆæ¡ˆéœ€è¦åœ–åºŠï¼Œä¹Ÿå¯ä»¥å†é–‹ä¸€å€‹æ–°çš„ç›®éŒ„ï¼Œå°±å¯ä»¥å…±ç”¨é€™å€‹åœ–åºŠï¼ï¼

## ä¿®æ”¹æ–‡ç« 

åœ–ç‰‡å…¨éƒ¨è½‰ç§»éå»ä¹‹å¾Œï¼Œæ¥ä¸‹ä¾†å°±è¦ä¿®æ”¹åŸå§‹çš„æ–‡ç« ã€‚åŸæœ¬çš„å¦‚æœæˆ‘çš„æ–‡ç« è£¡éœ€è¦ç”¨åˆ°åœ–ç‰‡ï¼Œæˆ‘å¯ä»¥ç”¨ä»¥ä¸‹å¹¾ç¨®æ–¹å¼ä¾†æŒ‡å‘æœ¬åœ°çš„åœ–ç‰‡ï¼š

```html
![alt](dodgers-win-giants.jpg "Some figure caption")
```

```go-html-template
{{ figure src="ajr-at-shoreline-amphitheater.jpg" alt="alt" caption="Some figure caption" >}}
```

ä¸»è¦çš„é‡é»æ˜¯ï¼Œé€™äº›åœ–ç‰‡éƒ½æ˜¯ä½¿ç”¨ç›¸å°è·¯å¾‘ä¾†æŒ‡å‘è·Ÿæ–‡ç«  Markdown åŒç›®éŒ„ä¸‹çš„åœ–ç‰‡ã€‚æœ€ç›´è¦ºã€æš´åŠ›çš„æ–¹å¼å°±æ˜¯æˆ‘æ‰‹å‹•æˆ–è‡ªå‹•æŠŠæ‰€æœ‰åœ–ç‰‡é€£çµå…¨éƒ¨æ”¹æˆ hard-coded çš„é€£çµï¼Œä½†æˆ‘æ‰¾åˆ°äº†ä¸€å€‹æ›´å¥½çš„åšæ³•ï¼šç•¶æˆ‘åœ¨ Markdown è£¡ä½¿ç”¨ä¸Šé¢é€™å…©å€‹èªæ³•ä¾†æ’å…¥åœ–ç‰‡æ™‚ï¼ŒHugo åº•å±¤çš„ç”Ÿæˆé‚è¼¯æ˜¯å»ä½¿ç”¨ä¸»é¡Œè£¡æä¾›çš„ shortcodeï¼Œä¹Ÿå°±æ˜¯èª¬æˆ‘å¯ä»¥é­”æ”¹é€™å€‹ shortcode ä¾†è‡ªå‹•ä¿®æ”¹åœ–ç‰‡çš„é€£çµã€‚æ¯”æ–¹èªªæˆ‘ä½¿ç”¨çš„ Congo ä¸»é¡Œ shortcode æœ‰é€™éº¼ä¸€æ®µï¼š

```go-html-template {linenos=inline hl_lines=[7]}
<figure>
  {{- with $img -}}
    {{ $lazy := $.Page.Site.Params.enableImageLazyLoading | default true }}
    {{ $webp := $.Page.Site.Params.enableImageWebp | default true }}
    {{ partial "picture.html" (dict "img" . "alt" $altText "class" $class "x2" $x2 "lazy" $lazy "webp" $webp) }}
  {{- else -}}
    <img src="{{ .Destination | safeURL }}" alt="{{ $altText }}" class="{{ $class }}" />
  {{- end -}}
  {{ with $caption }}<figcaption class="text-center">{{ . | markdownify }}</figcaption>{{ end }}
</figure>
```

ç°¡å–®ä¾†èªªå°±æ˜¯å¦‚æœæœ‰æ‰¾åˆ°æœ¬åœ°åœ–ç‰‡ï¼Œå°±ä½¿ç”¨æœ¬åœ°åœ–ç‰‡ï¼Œå¦‚æœæ²’æœ‰ï¼Œå°±æŠŠå®ƒç•¶ä½œå¤–éƒ¨åœ–ç‰‡é€£çµã€‚æ‰€ä»¥æˆ‘å¯ä»¥é€™éº¼æ”¹ï¼š

```go-html-template {linenos=inline hl_lines=["7-8"]}
<figure>
  {{ $lazy := $.Page.Site.Params.enableImageLazyLoading | default true }}
  {{- with $img -}}
    {{ $webp := $.Page.Site.Params.enableImageWebp | default true }}
    {{ partial "picture.html" (dict "img" . "alt" $altText "class" $class "x2" $x2 "lazy" $lazy "webp" $webp) }}
  {{- else -}}
    {{ $path := printf "%s/%s" $.Page.File.ContentBaseName $file }}
    {{ partial "tomy-picture.html" (dict "path" $path "alt" $altText "class" $class "lazy" $lazy) }}
  {{- end -}}
  {{ with $caption }}<figcaption class="text-center">{{ . | markdownify }}</figcaption>{{ end }}
</figure>
```

åœ¨é€™è£¡æ‹¼å‡ºä¸€å€‹åœ–ç‰‡çš„ç›¸å°è·¯å¾‘ï¼Œç„¶å¾Œå‘¼å«æˆ‘è‡ªå·±çš„æ¨¡æ¿ï¼š

```go-html-template
{{ with $path }}
  {{ $remoteSrc := printf "%s/%s" site.Params.services.img . }}
  <picture {{ with $class }} class="{{ . }}" {{ end }}>
    <img
      src="{{ $remoteSrc }}"
      {{ with $class }}class="{{ . }}"{{ end }}
      {{ with $alt }}alt="{{ . }}"{{ end }}
      {{ with $lazy }}loading="lazy" decoding="async"{{ end }}
    />
  </picture>
{{ end }}
```

æ³¨æ„åˆ°æˆ‘é€™è£¡ä¸¦æ²’æœ‰ hard-code æˆ‘çš„åœ–åºŠé€£çµï¼Œè€Œæ˜¯æŠŠå®ƒæ”¾åœ¨ hugo çš„ config è£¡ï¼š

```toml
# config/_default/params.toml
[services]
  img = "https://img.tomy.me/blog"
```

é€™éº¼ä¸€ä¾†ï¼Œä¸ä½†ä¸éœ€è¦ä¿®æ”¹ä»»ä½•èˆŠæ–‡ç« ä¸­çš„åœ–ç‰‡é€£çµï¼Œå³ä½¿æœªä¾†è¦å†æ¬å®¶ï¼Œä¹Ÿåªè¦ä¿®æ”¹ config å°±å¥½ ğŸ‘ğŸ»

ç•¶ç„¶ä¸­é–“é‚„æœ‰å¾ˆå¤šç´°ç¯€å°±ä¸è´…è¿°äº†ï¼Œæœ‰èˆˆè¶£çš„å¯ä»¥å»çœ‹çœ‹[é€™å€‹ GitHub issue](https://github.com/tomy0000000/blog/issues/37) é‚„æœ‰è£¡é¢æåˆ°ç›¸é—œçš„ commitã€‚

## ç§»é™¤åœ–ç‰‡

åˆ°é€™è£¡ï¼Œæ‰€æœ‰åœ–ç‰‡å·²ç¶“æ­£å¼ç”¨ä¸Šäº†å¤–éƒ¨çš„åœ–åºŠã€‚æœ€å¾Œä¸€æ­¥å°±æ˜¯ï¼ŒæŠŠç¾æœ‰çš„åœ–ç‰‡ç§»é™¤ã€‚æˆ‘ç°¡å–® Google + è·Ÿ ChatGPT èŠå®Œçš„çµè«–æ˜¯ï¼Œåªèƒ½ç”¨ `git filter-repo` ä¾†æŠŠåœ–ç‰‡å…¨éƒ¨æ¸…æ‰ï¼Œæ²’è¾¦æ³•ä¿ç•™åŸæœ¬çš„ commitã€‚å¯¦å‹™ä¸Šä¾†èªªæ˜¯ä½¿ç”¨äº†å¦å¤–ä¸€å€‹å·¥å…·å« [`git-filter-repo`](https://github.com/newren/git-filter-repo)ï¼Œå…·é«”æ­¥é©Ÿæˆ‘ä¹Ÿå¯«æˆäº†[ä¸€ä»½ç­†è¨˜](https://docs.tomy.me/git/#wipe-files-from-the-history)ï¼Œé€™è£¡å°±ä¸å†å¯«ä¸€æ¬¡äº†ã€‚

## çµæœ

ç¾åœ¨é‡æ–° `git clone` ä¸‹ä¾†çš„å¤§å°å¾åŸæœ¬çš„ 1.3 GB ä¸€å£æ°£æ¸›å°‘åˆ°äº† 3.5 MBã€‚ä¸æ­¢å¦‚æ­¤ï¼ŒåŸæœ¬æ¯æ¬¡ç™¼æ–°çš„æ–‡ç« ï¼Œæ•´å€‹ç¶²ç«™é‡æ–°ç”Ÿæˆè¦åœ¨ GitHub Action ä¸Šè·‘ 8 åˆ†é˜ï¼Œç¾åœ¨åªè¦ä¸åˆ° 1 åˆ†é˜å°±å¥½äº†ï¼

{{< chart >}}
type: 'bar',
data: {
  labels: ['34f18f0', '80c2d58', '13efd8c', '92c3565', '35c1995', '48ac371', 'b342a01', '0b44cdd', '89327c0', '1279c71', 'b3f115a', '51a0d2b', '2a8294e'],
  datasets: [{
    label: 'Github Action éƒ¨ç½²æ™‚é–“ (ç§’)',
    data: [528, 525, 507, 527, 507, 539, 507, 512, 522, 504, 39, 38, 40],
  }]
}
{{< /chart >}}
<figcaption class="text-center"> çœŸæ˜¯å¤ªç¥å¥‡äº†ï¼Œå‚‘å…‹ï¼</figcaption>

---

å‰å‰å¾Œå¾Œå¾ç ”ç©¶åˆ°çœŸçš„å®Œå…¨å¯¦ç¾èŠ±äº†ä¸å°‘æ™‚é–“ï¼Œä½†æ•´å€‹æ¬é·åšå®Œä¹Ÿæ˜¯æŒºæœ‰æˆå°±æ„Ÿçš„ï¼Œæ„Ÿè¦ºåˆå° Hugo æ›´ä¸Šæ‰‹äº†ä¸€äº›ï¼
